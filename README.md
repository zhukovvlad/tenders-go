# tenders-go

**tenders-go** — серверная часть системы управления тендерами и заявками. Проект реализован на Go, взаимодействует с PostgreSQL, поддерживает современные подходы к работе с данными, расширяемую архитектуру и REST API.

---

## Основные возможности

- **Импорт и обработка тендеров**: поддерживается загрузка тендерных данных в формате JSON, автоматическое создание/обновление связанных сущностей (объекты, исполнители и т.д.).
- **Трёхуровневая иерархия справочников**: типы тендеров, разделы (chapters), категории.
- **Гибкое управление тендерами и лотами**: создание, обновление, удаление с контролем целостности (RESTRICT/CASCADE), обработка ошибок на уровне приложения.
- **Работа с подрядчиками, предложениями и аналитикой**: сложные аналитические запросы, расширенные структуры для расчёта победителей и детальной аналитики.
- **Семантический поиск**: поддержка поиска по векторам (RAG, HNSW-индексы) для работы с большими объёмами документов.
- **API с пагинацией**: все списковые запросы поддерживают постраничную отдачу.
- **Миграции и автогенерация кода**: структура базы и слой доступа к данным на базе [sqlc](https://sqlc.dev/).
- **Унификация CRUD и паттерн частичного обновления**: обобщённые service-функции getOrCreateOrUpdate, PATCH-обновление тендеров.
- **Разделение обработчиков**: каждый тип сущности реализован отдельным handler-файлом для удобства поддержки и расширения.

---

## Структура репозитория

- `cmd/internal/db/query/` — SQL-запросы, используемые с генератором кода [sqlc](https://sqlc.dev/).
- `cmd/internal/db/migration/` — миграции для схемы базы данных.
- `cmd/internal/server/` — обработчики REST API: импорт, справочники, тендеры, предложения и др.
- `cmd/internal/api_models/` — структуры данных для обмена через API.
- `cmd/internal/util/` — утилитарный код.
- `cmd/main.go` — точка входа, запуск сервера.

---

## Примеры последних изменений (2025)

- Рефакторинг импорт-обработчика тендеров: полностью переработан для надёжной обработки JSON, строгой валидации и атомарных транзакций.
- Унификация сервисных функций: добавлены обобщённые getOrCreateOrUpdate для ключевых сущностей.
- Разделение API-обработчиков: каждый handler вынесен в отдельный файл (`handlers_tender.go`, `handlers_import.go`, `handlers_categories.go`, ...).
- Добавлены эндпоинты для получения/создания/обновления типов, разделов и категорий тендеров с поддержкой пагинации.
- PATCH-обновление тендеров и upsert-операции для справочников.
- Обновлены структуры API-ответов (например, предложения теперь содержат поле additional_info как JSON).

---

## Технологии

- **Go** — основная бизнес-логика и REST API.
- **PostgreSQL** с поддержкой транзакций, cascade/restrict-операций.
- **sqlc** — генерация strongly-typed Go кода из SQL.
- **Gin** — HTTP-фреймворк для API.
- **HNSW/semantic search** — для продвинутого поиска (опционально).

---

## Ключевые сущности

- **Тендеры** (`tenders`)
- **Лоты** (`lots`)
- **Объекты** (`objects`), **Исполнители** (`executors`)
- **Подрядчики** (`contractors`), **Контактные лица** (`persons`)
- **Предложения** (`proposals`), **Победители** (`winners`)
- **Детализация** (`position_items`, `proposal_summary_lines`, `lots_md_documents`, `lots_chunks` и др.)

---

## Принципы работы с удалением

- `ON DELETE RESTRICT` — предотвращает удаление записей с внешними связями.
- `ON DELETE CASCADE` — каскадное удаление связанных данных.
- Контроль целостности через БД и уровень приложения.

---

## TODO

Список актуальных задач по доработке SQL-запросов и бизнес-логики: [`cmd/internal/db/query/TODO.md`](cmd/internal/db/query/TODO.md)

---

## Контрибьюция

PR и багрепорты приветствуются! Для сложных изменений и архитектурных вопросов — пожалуйста, создавайте issue для обсуждения.

---

**Автор:** [zhukovvlad](https://github.com/zhukovvlad)
